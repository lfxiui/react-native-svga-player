def DEFAULT_COMPILE_SDK = 35
def DEFAULT_MIN_SDK = 24
def DEFAULT_TARGET_SDK = 34
def SVGAPLAYER_VERSION = '2.6.1'

def safeExtGet(prop, fallback) {
    rootProject.ext.has(prop) ? rootProject.ext.get(prop) : fallback
}

apply plugin: 'com.android.library'
apply plugin: 'maven-publish'

buildscript {
    if (project == rootProject) {
        repositories {
            google()
            mavenCentral()
        }
        dependencies {
            classpath 'com.android.tools.build:gradle:8.3.0'
        }
    }
}

android {
    namespace "bang.svga.player"
    compileSdk safeExtGet('compileSdk', DEFAULT_COMPILE_SDK)
    defaultConfig {
        minSdk safeExtGet('minSdk', DEFAULT_MIN_SDK)
        targetSdk safeExtGet('targetSdk', DEFAULT_TARGET_SDK)
        versionCode 1
        versionName "1.0"
    }
    lintOptions {
        abortOnError false
    }
}

repositories {
    mavenLocal()
    maven { url "$rootDir/../node_modules/react-native/android" }
    maven { url "$rootDir/../node_modules/jsc-android/dist" }
    google()
    mavenCentral()
    maven { url 'https://jitpack.io' }
}

dependencies {
    implementation 'com.facebook.react:react-native:+'
    implementation "com.github.yyued:SVGAPlayer-Android:$SVGAPLAYER_VERSION"
}

afterEvaluate { project ->
    task androidSourcesJar(type: Jar) {
        classifier = 'sources'
        from android.sourceSets.main.java.srcDirs
        include '**/*.java'
    }
}

publishing {
    publications {
        release(MavenPublication) {
            groupId = "bang.svga.player"
            artifactId = "react-native-svga-player"
            version = "1.0"
            artifact(androidSourcesJar)
            artifact("$buildDir/outputs/aar/${project.getName()}-release.aar")
        }
    }
}